<div class="shared-file-container" dir="rtl">
  <!-- Background Elements -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <div class="floating-shape absolute top-10 right-10 w-32 h-32 rounded-full animate-float" 
         style="background: linear-gradient(135deg, var(--primary-400), var(--secondary-400)); opacity: 0.1;"></div>
    <div class="floating-shape absolute bottom-20 left-20 w-24 h-24 rounded-full animate-float-delayed" 
         style="background: linear-gradient(135deg, var(--success-500), var(--primary-400)); opacity: 0.1;"></div>
  </div>

  <div class="relative z-10 max-w-7xl mx-auto">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
      <div class="loading-card">
        <p-progressSpinner strokeWidth="3" styleClass="custom-spinner" />
        <h2 class="loading-title">{{'Loading File'|translate}}</h2>
        <p class="loading-subtitle">{{'Please wait while we fetch your file'|translate}}</p>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-container">
      <div class="error-card">
        <div class="error-icon">
          <i class="pi pi-exclamation-triangle"></i>
        </div>
        <h2 class="error-title">{{'File Not Found'|translate}}</h2>
        <p class="error-message">{{ errorMessage }}</p>
        <div class="error-actions">
          <p-button 
            icon="pi pi-home" 
            [label]="'Go to Home'|translate"
            (onClick)="goToHome()"
            severity="primary"
            styleClass="modern-btn-primary"
          />
          <p-button 
            icon="pi pi-sign-in" 
            [label]="'Login'|translate"
            (onClick)="goToLogin()"
            severity="secondary"
            styleClass="modern-btn-glass"
          />
        </div>
      </div>
    </div>

    <!-- File Display -->
    <div *ngIf="fileLoaded && !loading && !error" class="file-display-container">
      <!-- File Header -->
      <div class="file-header">
        <div class="header-content">
          <!-- File Info -->
          <div class="file-info">
            <div class="file-icon">
              <i [class]="getFileIcon()"></i>
            </div>
            <div class="file-details">
              <h1 class="file-title">{{ fileName }}</h1>
              <div class="file-meta">
                <span class="file-type">{{ getFileTypeLabel() }}</span>
                <span class="file-size">{{ formatFileSize(fileSize) }}</span>
                <span class="file-extension" *ngIf="fileExtension">.{{ fileExtension.toUpperCase() }}</span>
              </div>
            </div>
          </div>
          
          <!-- Action Buttons -->
          <div class="file-actions">
            <p-button
              icon="pi pi-download"
              [label]="'Download'|translate"
              (onClick)="downloadFile()"
              severity="primary"
              styleClass="modern-btn-primary"
              pTooltip="{{'Download File'|translate}}"
            />
            <p-button
              icon="pi pi-copy"
              [label]="'Copy Link'|translate"
              (onClick)="copyLink()"
              severity="secondary"
              styleClass="modern-btn-glass"
              pTooltip="{{'Copy Share Link'|translate}}"
            />
            <p-button
              icon="pi pi-refresh"
              (onClick)="refreshFile()"
              severity="secondary"
              styleClass="modern-btn-glass"
              pTooltip="{{'Refresh File'|translate}}"
            />
          </div>
        </div>
      </div>

      <!-- Universal File Viewer -->
      <div class="file-viewer">
        
        <!-- PDF Viewer -->
        <div *ngIf="isPdfFile()" class="pdf-viewer">
          <iframe 
            [src]="safeFileUrl" 
            class="document-frame"
            title="PDF Viewer">
            <p>{{'Your browser does not support PDF viewing'|translate}}</p>
          </iframe>
        </div>

        <!-- Image Viewer -->
        <div *ngIf="isImageFile() && !isPdfFile()" class="image-viewer">
          <img 
            [src]="fileUrl" 
            [alt]="fileName"
            class="image-display"
          />
        </div>

        <!-- Video Viewer -->
        <div *ngIf="isVideoFile()" class="video-viewer">
          <video 
            [src]="fileUrl" 
            controls
            class="video-display"
            preload="metadata">
            {{'Your browser does not support video playback'|translate}}
          </video>
        </div>

        <!-- Audio Viewer -->
        <div *ngIf="isAudioFile()" class="audio-viewer">
          <div class="audio-container">
            <div class="audio-info">
              <i class="pi pi-volume-up audio-icon"></i>
              <span class="audio-title">{{ fileName }}</span>
            </div>
            <audio 
              [src]="fileUrl" 
              controls
              class="audio-display"
              preload="metadata">
              {{'Your browser does not support audio playback'|translate}}
            </audio>
          </div>
        </div>

        <!-- Text File Viewer -->
        <div *ngIf="isTextFile() && !isImageFile()" class="text-viewer">
          <iframe 
            [src]="safeFileUrl" 
            class="document-frame"
            title="Text Viewer">
            <p>{{'Your browser does not support text viewing'|translate}}</p>
          </iframe>
        </div>

        <!-- Office Documents Viewer (Word, Excel, PowerPoint) -->
        <div *ngIf="isOfficeFile()" class="office-viewer">
          <div class="viewer-tabs">
            <button 
              class="viewer-tab active" 
              onclick="this.parentElement.querySelector('.active').classList.remove('active'); this.classList.add('active'); 
                       this.parentElement.parentElement.querySelector('.google-viewer').style.display = 'block';
                       this.parentElement.parentElement.querySelector('.office-viewer-frame').style.display = 'none';">
              {{'Google Docs Viewer'|translate}}
            </button>
            <button 
              class="viewer-tab" 
              onclick="this.parentElement.querySelector('.active').classList.remove('active'); this.classList.add('active');
                       this.parentElement.parentElement.querySelector('.google-viewer').style.display = 'none';
                       this.parentElement.parentElement.querySelector('.office-viewer-frame').style.display = 'block';">
              {{'Office Online Viewer'|translate}}
            </button>
          </div>
          
          <!-- Google Docs Viewer -->
          <div class="google-viewer">
            <iframe 
              [src]="sanitizer.bypassSecurityTrustResourceUrl(getGoogleDocsViewerUrl())" 
              class="document-frame"
              title="Google Docs Viewer">
              <p>{{'Document viewer not available'|translate}}</p>
            </iframe>
          </div>
          
          <!-- Office Online Viewer -->
          <div class="office-viewer-frame" style="display: none;">
            <iframe 
              [src]="sanitizer.bypassSecurityTrustResourceUrl(getOfficeOnlineViewerUrl())" 
              class="document-frame"
              title="Office Online Viewer">
              <p>{{'Office viewer not available'|translate}}</p>
            </iframe>
          </div>
        </div>

        <!-- Generic File Viewer for other types -->
        <div *ngIf="!canPreview()" class="generic-viewer">
          <div class="generic-content">
            <div class="generic-icon">
              <i [class]="getFileIcon()"></i>
            </div>
            <h3>{{ getFileTypeLabel() }}</h3>
            <p>{{'This file type requires downloading to view'|translate}}</p>
            <div class="file-info-details">
              <div class="info-row">
                <span class="info-label">{{'File Name'|translate}}:</span>
                <span class="info-value">{{ fileName }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">{{'File Size'|translate}}:</span>
                <span class="info-value">{{ formatFileSize(fileSize) }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">{{'File Type'|translate}}:</span>
                <span class="info-value">{{ fileType }}</span>
              </div>
            </div>
            <p-button
              icon="pi pi-download"
              [label]="'Download to View'|translate"
              (onClick)="downloadFile()"
              severity="primary"
              styleClass="modern-btn-primary"
              size="large"
            />
          </div>
        </div>

      </div>

      <!-- Shared File Notice -->
      <div class="shared-notice">
        <div class="notice-content">
          <i class="pi pi-share-alt notice-icon"></i>
          <div class="notice-text">
            <h4>{{'Shared File'|translate}}</h4>
            <p>{{'This file was shared with you via a secure link'|translate}}</p>
          </div>
        </div>
      </div>

      <!-- Footer Actions -->
      <div class="footer-actions">
        <p-button
          icon="pi pi-home"
          [label]="'Visit Our Website'|translate"
          (onClick)="goToHome()"
          severity="secondary"
          styleClass="modern-btn-outline"
          [text]="true"
        />
        <p-button
          icon="pi pi-sign-in"
          [label]="'Login to Access More'|translate"
          (onClick)="goToLogin()"
          severity="primary"
          styleClass="modern-btn-outline"
          [text]="true"
        />
      </div>
    </div>
  </div>
</div>

<!-- Toast Messages -->
<p-toast position="top-right" />
