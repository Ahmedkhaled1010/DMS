<div class="min-h-screen p-4 md:p-6 lg:p-8 relative overflow-hidden" style="background: linear-gradient(135deg, var(--bg-secondary), var(--primary-50), var(--secondary-50));" dir="rtl">
  
  <!-- Animated Background Elements -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <div class="floating-shape absolute top-10 right-10 w-32 h-32 rounded-full animate-float" style="background: linear-gradient(135deg, var(--primary-400), var(--secondary-400)); opacity: 0.1;"></div>
    <div class="floating-shape absolute bottom-20 left-20 w-24 h-24 rounded-full animate-float-delayed" style="background: linear-gradient(135deg, var(--success-500), var(--primary-400)); opacity: 0.1;"></div>
    <div class="floating-shape absolute top-1/2 left-1/3 w-16 h-16 rounded-full animate-pulse" style="background: linear-gradient(135deg, var(--secondary-400), var(--primary-400)); opacity: 0.1;"></div>
  </div>

  <div class="relative z-10 max-w-7xl mx-auto space-y-6 lg:space-y-8">
    
    <!-- Header Section -->
    <div class="glass-card p-6 lg:p-8 animate-in slide-in-from-top duration-800">
      <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-6">
        <div class="flex items-center gap-4">
          <div class="icon-container icon-container-blue">
            <i class="pi pi-file text-white text-xl"></i>
          </div>
          <div>
            <h1 class="document-title">{{'Manage documents'|translate}}</h1>
            <p class="document-subtitle">{{'View and manage all files in the system'|translate}}</p>
          </div>
        </div>
        
        <div class="flex items-center gap-3 w-full lg:w-auto">
          <p-button
            icon="pi pi-refresh"
            [label]="'Update'|translate"
            (onClick)="refreshData()"
            severity="secondary"
            size="small"
            styleClass="flex-1 lg:flex-none modern-btn-glass"
          />
          <p-button
            icon="pi pi-plus"
            [label]="'New Document'|translate"
            (onClick)="addNewDocument()"
            severity="primary"
            size="small"
            styleClass="flex-1 lg:flex-none modern-btn-primary"
          />
        </div>
      </div>
    </div>

    <!-- Mobile Filter Toggle -->
    <div class="md:hidden animate-in slide-in-from-right duration-800 delay-200">
      <p-button
        [icon]="showMobileFilters ? 'pi pi-chevron-up' : 'pi pi-filter'"
        [label]="showMobileFilters ? 'إخفاء الفلاتر' : 'إظهار الفلاتر'"
        (onClick)="toggleMobileFilters()"
        severity="secondary"
        styleClass="w-full modern-btn-glass"
        size="small"
      />
    </div>

    <!-- Filters Panel -->
    <div 
      class="glass-card p-6 transition-all duration-500 animate-in slide-in-from-left duration-800 delay-300"
      [class.hidden]="!showMobileFilters"
      [class.md:block]="true"
    >
      <div class="flex items-center gap-3 mb-6">
        <div class="icon-container icon-container-purple">
          <i class="pi pi-filter text-white"></i>
        </div>
        <h3 class="section-title">{{'Filters and search'|translate}}</h3>
        <p-button
          *ngIf="hasActiveFilters"
          icon="pi pi-times"
          [label]="'Clear filters'|translate"
          (onClick)="clearFilters()"
          [text]="true"
          severity="secondary"
          size="small"
          styleClass="modern-btn-hover"
        />
      </div>

      <!-- Search -->
      <div class="mb-6">
        <label class="filter-label">
          <i class="pi pi-search" style="color: var(--primary-500);"></i>
          {{'Search'|translate}}
        </label>
        <input
          pInputText
          [(ngModel)]="searchTerm"
          name="searchTerm"
          [placeholder]="'Search by file name'|translate"
          class="modern-input w-full"
          (input)="onSearchChange()"
        />
      </div>

      <!-- Filters Grid -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
        <!-- File Type Filter -->
        <div class="filter-item">
          <label class="filter-label">
            <i class="pi pi-file" style="color: var(--success-500);"></i>
            {{'File type'|translate}}
          </label>
          <p-dropdown
            [(ngModel)]="selectedFileType"
            [options]="fileTypeOptions"
            [placeholder]="'All types'|translate"
            [showClear]="true"
            styleClass="w-full modern-dropdown"
            (onChange)="onFilterChange()"
            appendTo="body"
          />
        </div>

        <!-- Tag Filter -->
        <div class="filter-item">
          <label class="filter-label">
            <i class="pi pi-tag" style="color: var(--warning-500);"></i>
            {{'Classification'|translate}}
          </label>
          <p-dropdown
            [(ngModel)]="selectedTag"
            [options]="tagOptions"
            [placeholder]="'Classification'|translate"
            [showClear]="true"
            styleClass="w-full modern-dropdown"
            (onChange)="onFilterChange()"
            appendTo="body"
          />
        </div>

        <!-- Privacy Filter -->
        <div class="filter-item">
          <label class="filter-label">
            <i class="pi pi-shield" style="color: var(--danger-500);"></i>
            {{'Privacy'|translate}}
          </label>
          <p-dropdown
            [(ngModel)]="selectedPrivacy"
            [options]="privacyOptions"
            [placeholder]="'All levels of privacy'|translate"
            [showClear]="true"
            styleClass="w-full modern-dropdown"
            (onChange)="onFilterChange()"
            appendTo="body"
          />
        </div>

        <!-- Workspace Filter -->
        <div class="filter-item">
          <label class="filter-label">
            <i class="pi pi-home" style="color: var(--info-500);"></i>
            {{'Work Space'|translate}}
          </label>
          <p-dropdown
            [(ngModel)]="selectedWorkspace"
            [options]="workspaceOptions"
            optionLabel="name"
            optionValue="id"
            [placeholder]="'All workspaces'|translate"
            [showClear]="true"
            styleClass="w-full modern-dropdown"
            (onChange)="onFilterChange()"
            appendTo="body"
          />
        </div>

        <!-- Size Range -->
        <div class="filter-item sm:col-span-2 lg:col-span-1">
          <label class="filter-label">
            <i class="pi pi-database" style="color: var(--secondary-500);"></i>
            {{'Size range'|translate}}
          </label>
          <div class="flex gap-2">
            <p-inputNumber
              [(ngModel)]="minSize"
              [placeholder]="'From'|translate"
              [min]="0"
              [max]="1000"
              styleClass="w-full modern-input-number"
              (onInput)="onFilterChange()"
            />
            <p-inputNumber
              [(ngModel)]="maxSize"
              [placeholder]="'To'|translate"
              [min]="0"
              [max]="1000"
              styleClass="w-full modern-input-number"
              (onInput)="onFilterChange()"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- Statistics Cards -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 animate-in slide-in-from-bottom duration-800 delay-400">
      <div class="stat-card stat-card-blue">
        <div class="flex items-center justify-between">
          <div>
            <p class="stat-label">{{'Total Documents'|translate}}</p>
            <p class="stat-value">{{ totalRecords }}</p>
          </div>
          <div class="stat-icon">
            <i class="pi pi-file"></i>
          </div>
        </div>
      </div>
      
      <div class="stat-card stat-card-green">
        <div class="flex items-center justify-between">
          <div>
            <p class="stat-label">{{'Active Documents'|translate}}</p>
            <p class="stat-value">{{ activeFilesCount }}</p>
          </div>
          <div class="stat-icon">
            <i class="pi pi-check-circle"></i>
          </div>
        </div>
      </div>
      
      <div class="stat-card stat-card-red">
        <div class="flex items-center justify-between">
          <div>
            <p class="stat-label">{{'Deleted Documents'|translate}}</p>
            <p class="stat-value">{{ deletedFilesCount }}</p>
          </div>
          <div class="stat-icon">
            <i class="pi pi-trash"></i>
          </div>
        </div>
      </div>
      
      <div class="stat-card stat-card-purple col-span-2 lg:col-span-1">
        <div class="flex items-center justify-between">
          <div>
            <p class="stat-label">{{'Total Size'|translate}}</p>
            <p class="stat-value">{{ formatFileSize(totalSize) }}</p>
          </div>
          <div class="stat-icon">
            <i class="pi pi-database"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Mobile Cards View -->
    <div class="md:hidden space-y-4 animate-in slide-in-from-right duration-800 delay-500" *ngIf="!loading && documents.length > 0">
      <div class="glass-card p-4">
        <div class="flex items-center justify-between">
          <h3 class="section-title">الملفات ({{ totalRecords }})</h3>
          <p-button
            [icon]="showTableView ? 'pi pi-list' : 'pi pi-table'"
            [label]="showTableView ? 'عرض البطاقات' : 'عرض الجدول'"
            (onClick)="toggleView()"
            severity="secondary"
            size="small"
            styleClass="modern-btn-glass"
          />
        </div>
      </div>

      <!-- Mobile Cards -->
      <div *ngIf="!showTableView" class="space-y-4">
        <div 
          *ngFor="let document of documents; trackBy: trackByDocumentId"
          class="mobile-card"
          [class.mobile-card-deleted]="document.isDeleted"
        >
          <!-- Card Header -->
          <div class="flex items-start justify-between mb-4">
            <div class="flex items-center gap-3 flex-1 min-w-0">
              <div class="file-icon-mobile">
                <i [class]="getFileIcon(document.fileType)"></i>
              </div>
              <div class="min-w-0 flex-1">
                <h4 class="mobile-card-title" [title]="document.fileName">
                  {{ document.fileName }}
                </h4>
                <p class="mobile-card-subtitle">{{ document.filePath }}</p>
              </div>
            </div>
            <p-button
              icon="pi pi-ellipsis-v"
              [text]="true"
              [rounded]="true"
              severity="secondary"
              size="small"
              styleClass="modern-btn-hover"
            />
          </div>

          <!-- Card Content -->
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div class="mobile-info-item">
              <span class="mobile-info-label">النوع:</span>
              <p-tag
                [value]="document.fileType.toUpperCase()"
                [severity]="getFileTypeSeverity(document.fileType)"
                styleClass="modern-tag-small"
              />
            </div>
            <div class="mobile-info-item">
              <span class="mobile-info-label">الحجم:</span>
              <span class="mobile-info-value">{{ formatFileSize(document.size) }}</span>
            </div>
            <div class="mobile-info-item">
              <span class="mobile-info-label">التصنيف:</span>
              <p-tag
                [value]="getTagLabel(document.tag)"
                [severity]="getTagSeverity(document.tag)"
                styleClass="modern-tag-small"
              />
            </div>
            <div class="mobile-info-item">
              <span class="mobile-info-label">الخصوصية:</span>
              <p-tag
                [value]="getPrivacyLabel(document.privacy)"
                [severity]="getPrivacySeverity(document.privacy)"
                [icon]="getPrivacyIcon(document.privacy)"
                styleClass="modern-tag-small"
              />
            </div>
            <div class="mobile-info-item col-span-2">
              <span class="mobile-info-label">تاريخ الإنشاء:</span>
              <span class="mobile-info-value">{{ document.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
          </div>

          <!-- Card Footer -->
          <div class="flex items-center justify-between pt-4 border-t" style="border-color: var(--border-primary);">
            <div class="flex items-center gap-2">
              <p-tag
                [value]="document.isDeleted ? 'محذوف' : 'نشط'"
                [severity]="document.isDeleted ? 'danger' : 'success'"
                [icon]="document.isDeleted ? 'pi pi-trash' : 'pi pi-check'"
                styleClass="modern-tag-small"
              />
              <p-badge
                [value]="'v' + document.version"
                severity="info"
                styleClass="modern-badge-small"
              />
            </div>
            <div class="flex items-center gap-1">
              <p-button
                icon="pi pi-eye"
                [text]="true"
                [rounded]="true"
                severity="info"
                size="small"
                (onClick)="viewDocument($event,document)"
                styleClass="modern-btn-hover"
              />
              <p-button
                icon="pi pi-download"
                [text]="true"
                [rounded]="true"
                severity="secondary"
                size="small"
                (onClick)="downloadDocument($event,document)"
                styleClass="modern-btn-hover"
              />
              <p-button
                *ngIf="!document.isDeleted"
                icon="pi pi-trash"
                [text]="true"
                [rounded]="true"
                severity="danger"
                size="small"
                (onClick)="deleteDocument($event,document)"
                styleClass="modern-btn-hover"
              />
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Desktop Table View -->
    <div 
      class="glass-card overflow-hidden animate-in slide-in-from-bottom duration-800 delay-600"
      [class.hidden]="!showTableView"
      [class.md:block]="true"
    >
      <p-table
        [value]="documents"
        [lazy]="true"
        [paginator]="true"
        [rows]="pageSize"
        [totalRecords]="totalRecords"
        [loading]="loading"
        [showCurrentPageReport]="true"
        [currentPageReportTemplate]="'VIEW_FROM_TO_TOTAL' | translate:{ first: '{first}', last: '{last}', totalRecords: '{totalRecords}' }"
        [rowsPerPageOptions]="[5,10, 25, 50, 100]"
        [sortField]="sortField"
        [sortOrder]="sortOrder"
        (onLazyLoad)="onLazyLoad($event)"
        styleClass="modern-table"
        [tableStyle]="{'min-width': '80rem'}"
        [scrollable]="true"
        [scrollHeight]="getTableHeight()"
        [responsiveLayout]="'scroll'"
      >
        <!-- Table Header -->
        <ng-template pTemplate="header">
          <tr>
            <th style="width: 3rem" class="hidden lg:table-cell">
              <p-tableHeaderCheckbox />
            </th>
            <th pSortableColumn="fileName" style="min-width: 200px">
              {{'File name'|translate}}
              <p-sortIcon field="fileName" />
            </th>
            <th pSortableColumn="fileType" style="width: 100px" class="hidden sm:table-cell">
              {{'Type'|translate}}
              <p-sortIcon field="fileType" />
            </th>
            <th pSortableColumn="size" style="width: 120px" class="hidden md:table-cell">
              {{'Size'|translate}}
              <p-sortIcon field="size" />
            </th>
            <th pSortableColumn="tag" style="width: 130px" class="hidden lg:table-cell">
              {{'Classification'|translate}}
              <p-sortIcon field="tag" />
            </th>
            <th pSortableColumn="privacy" style="width: 120px" class="hidden xl:table-cell">
              {{'Privacy'|translate}}
              <p-sortIcon field="privacy" />
            </th>
            <th pSortableColumn="version" style="width: 80px" class="hidden xl:table-cell">
              {{'Version'|translate}}
              <p-sortIcon field="version" />
            </th>
            <th pSortableColumn="workspaceName" style="width: 150px" class="hidden 2xl:table-cell">
              {{'Work Space'|translate}}
              <p-sortIcon field="workspaceName" />
            </th>
            <th pSortableColumn="folderName" style="width: 100px" class="hidden md:table-cell">
              {{'Folder'|translate}}
              <p-sortIcon field="folderName" />
            </th>
            <th pSortableColumn="createdAt" style="width: 150px" class="hidden lg:table-cell">
              {{'Creation date'|translate}}
              <p-sortIcon field="createdAt" />
            </th>
            <th style="width: 120px">{{'Actions'|translate}}</th>
          </tr>
        </ng-template>

        <!-- Table Body -->
        <ng-template pTemplate="body" let-document let-rowIndex="rowIndex">
          <tr [routerLink]="['/home/Documentdetails',document.id]" class="table-row" [class.table-row-deleted]="document.isDeleted">
            <td class="hidden lg:table-cell">
              <p-tableCheckbox [value]="document" />
            </td>
            <td>
              <div class="flex items-center gap-3">
                <div class="file-icon-table">
                  <i [class]="getFileIcon(document.fileType)"></i>
                </div>
                <div class="min-w-0">
                  <p class="table-file-name" [title]="document.fileName">
                    {{ document.fileName }}
                  </p>
                  <p class="table-file-info md:hidden">
                    {{ formatFileSize(document.size) }} • {{ getTagLabel(document.tag) }}
                  </p>
                </div>
              </div>
            </td>
            <td class="hidden sm:table-cell">
              <p-tag
                [value]="document.fileType.toUpperCase()"
                [severity]="getFileTypeSeverity(document.fileType)"
                styleClass="modern-tag"
              />
            </td>
            <td class="hidden md:table-cell">
              <span class="table-text">{{ formatFileSize(document.size) }}</span>
            </td>
            <td class="hidden lg:table-cell">
              <p-tag
                [value]="document.tag"
                [severity]="getTagSeverity(document.tag)"
                styleClass="modern-tag"
              />
            </td>
            <td class="hidden xl:table-cell">
              <p-tag
                [value]="document.privacy"
                [severity]="getPrivacySeverity(document.privacy)"
                [icon]="getPrivacyIcon(document.privacy)"
                styleClass="modern-tag"
              />
            </td>
            <td class="hidden xl:table-cell">
              <p-badge
                [value]="'v' + document.version"
                severity="info"
                styleClass="modern-badge"
              />
            </td>
            <td class="hidden 2xl:table-cell">
              <span class="table-mono-text">{{ document.workspaceName }}</span>
            </td>
            <td class="hidden md:table-cell">
              <span class="table-mono-text">{{ document.folderName }}</span>
            </td>
            <td class="hidden lg:table-cell">
              <span class="table-text">
                {{ document.createdAt | date:'dd/MM/yyyy HH:mm' }}
              </span>
            </td>
            <td>
              <div class="flex items-center gap-1">
                <!-- Mobile actions -->
                <p-button
                  icon="pi pi-eye"
                  [text]="true"
                  [rounded]="true"
                  severity="info"
                  size="small"
                  (onClick)="viewDocument($event,document)"
                  pTooltip="عرض"
                  tooltipPosition="top"
                  styleClass="md:hidden modern-btn-hover"
                />
               
                
                
                <!-- Desktop actions -->
                <div class="hidden md:flex items-center gap-1">
                  <p-button
                    icon="pi pi-eye"
                    [text]="true"
                    [rounded]="true"
                    severity="info"
                    size="small"
                    (onClick)="viewDocument($event,document)"
                    pTooltip="عرض"
                    tooltipPosition="top"
                    styleClass="modern-btn-hover"
                  />
                   <p-button
                    icon="fa-solid fa-expand"
                    [text]="true"
                    [rounded]="true"
                    severity="info"
                    size="small"
                    (onClick)="reviewDocument($event,document)"
                    pTooltip="عرض"
                    tooltipPosition="top"
                    styleClass="modern-btn-hover"
                  />
                  
                  <p-button
                    icon="pi pi-download"
                    [text]="true"
                    [rounded]="true"
                    severity="secondary"
                    size="small"
                    (onClick)="downloadDocument($event,document)"
                    pTooltip="تحميل"
                    tooltipPosition="top"
                    styleClass="modern-btn-hover"
                  />
                  <p-button
                    *ngIf="!document.isDeleted"
                    icon="pi pi-trash"
                    [text]="true"
                    [rounded]="true"
                    severity="danger"
                    size="small"
                    (onClick)="deleteDocument($event,document)"
                    pTooltip="حذف"
                    tooltipPosition="top"
                    styleClass="modern-btn-hover"
                  />
                </div>
              </div>
            </td>
          </tr>
        </ng-template>

        <!-- Empty State -->
        <ng-template pTemplate="emptymessage">
          <tr>
            <td [attr.colspan]="getColspan()" class="text-center py-12">
              <div class="empty-state">
                <div class="empty-icon">
                  <i class="pi pi-inbox"></i>
                </div>
                <h3 class="empty-title">لا توجد ملفات</h3>
                <p class="empty-description">لم يتم العثور على أي ملفات تطابق معايير البحث</p>
              </div>
            </td>
          </tr>
        </ng-template>

        <!-- Loading Template -->
        <ng-template pTemplate="loadingbody">
          <tr>
            <td [attr.colspan]="getColspan()">
              <div class="loading-container">
                <p-progressSpinner styleClass="w-8 h-8" />
                <span class="loading-text">جاري التحميل...</span>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>

    <!-- Mobile Pagination -->
    <div class="md:hidden animate-in slide-in-from-bottom duration-800 delay-700" *ngIf="totalRecords > pageSize">
      <div class="glass-card p-4">
        <p-paginator
          [rows]="pageSize"
          [totalRecords]="totalRecords"
          [first]="(currentPage - 1) * pageSize"
          (onPageChange)="onMobilePageChange($event)"
          [showCurrentPageReport]="true"
          currentPageReportTemplate="صفحة {currentPage} من {totalPages}"
          [showFirstLastIcon]="false"
          [showPageLinks]="false"
          styleClass="modern-paginator"
        />
      </div>
    </div>
  </div>
</div>

<!-- Toast Messages -->
<p-toast position="top-right" />

<!-- Confirmation Dialog -->
<p-confirmDialog />

<!-- Mobile Menu -->
<p-menu #mobileMenu [model]="mobileMenuItems" [popup]="true" appendTo="body" />

<!-- File Upload Component -->
<div>
  <app-fileupload (visibleChange)="uploadedDocument($event)" [visible]="visable"></app-fileupload>
</div>
