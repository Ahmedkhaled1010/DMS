<!-- Enhanced Document Manager Component -->
<div class="document-manager-container" dir="rtl">
  <!-- Header -->
  <div class="document-manager-card">
    <div class="document-manager-header">
      <div class="document-manager-header-content">
        <div class="document-manager-header-left">
          <div class="document-manager-icon-container">
            <i class="fas fa-folder-open document-manager-icon"></i>
          </div>
          <div>
            <h1 class="document-manager-title">{{'Document Manager'|translate}}</h1>
            <p class="document-manager-subtitle">{{'Manage folders and documents'|translate}}</p>
          </div>
        </div>
        @if (!workspace && currentDocuments.length!=0 && currentFolders.length!=0) {
          <div class="flex items-center gap-3">
            <button
              (click)="createNewFolder('workspace')"
              class="action-button yellow"
            >
              <i class="fas fa-folder-plus"></i>
              <span> {{'New Folder'|translate}}</span>
            </button>
            <button
              (click)="createNewDocument('workspace')"
              class="action-button"
            >
              <i class="fas fa-file-plus"></i>
              <span>{{'New Document'|translate}} </span>
            </button>
          </div>
        } @else {
          <div class="flex items-center gap-3">
            <button
              (click)="createNewFolder('folder')"
              class="action-button yellow"
            >
              <i class="fas fa-folder-plus"></i>
              <span> {{'New Folder'|translate}}</span>
            </button>
            <button
              (click)="createNewDocument('folder')"
              class="action-button"
            >
              <i class="fas fa-file-plus"></i>
              <span>{{'New Document'|translate}} </span>
            </button>
          </div>
        }
      </div>
    </div>
    <!-- Breadcrumb -->
    <div class="breadcrumb-container">
      <nav class="breadcrumb-nav">
        <button
          (click)="navigateToFolder('',undefined)"
          class="breadcrumb-link"
        >
          <i class="fas fa-home"></i>
          <span>{{"Home"|translate}}</span>
        </button>
        <span *ngIf="currentFolder" class="breadcrumb-separator">/</span>
        <span *ngIf="currentFolder" class="breadcrumb-current">
          {{ currentFolder.name }}
        </span>
      </nav>
    </div>
    <!-- Content -->
    <div class="document-manager-content">
      <!-- Loading State -->
      <div *ngIf="loading" class="loading-state">
        <i class="fas fa-spinner fa-spin loading-spinner"></i>
        <span class="text-gray-600">
          {{'Loading...'|translate}}</span>
      </div>
      <!-- Error State -->
      <div *ngIf="error" class="error-state">
        <i class="fas fa-exclamation-triangle error-icon"></i>
        <p class="error-message">{{ error }}</p>
      </div>
      <!-- Empty State -->
      <div *ngIf="!loading && !error && currentFolders.length === 0 && currentDocuments.length === 0 && folderId==undefined"
           class="empty-state">
        <i class="fas fa-folder-open empty-icon"></i>
        <h3 class="empty-title">{{'There are no files'|translate}}</h3>
        <p class="empty-message">
          {{'Start by creating a new folder or document.'|translate}}
        </p>
        <div class="empty-actions">
          <button
            (click)="createNewFolder('workspace')"
            class="action-button yellow"
          >
            <i class="fas fa-folder-plus"></i>
            <span> {{'Create New Folder'|translate}}</span>
          </button>
          <button
            (click)="createNewDocument('workspace')"
            class="action-button"
          >
            <i class="fas fa-file-plus"></i>
            <span>{{'Create New Document'|translate}} </span>
          </button>
        </div>
      </div>
      <div *ngIf="!loading && !error && currentFolders.length === 0 && currentDocuments.length === 0 && folderId!=undefined"
           class="empty-state">
        <i class="fas fa-folder-open empty-icon"></i>
        <h3 class="empty-title">{{'There are no files'|translate}}</h3>
        <p class="empty-message">
          {{'Start by creating a new folder or document.'|translate}}
        </p>
        <div class="empty-actions">
          <button
            (click)="createNewFolder('folder')"
            class="action-button yellow"
          >
            <i class="fas fa-folder-plus"></i>
            <span> {{'Create New Folder'|translate}}</span>
          </button>
          <button
            (click)="createNewDocument('folder')"
            class="action-button"
          >
            <i class="fas fa-file-plus"></i>
            <span>{{'Create New Document'|translate}} </span>
          </button>
        </div>
      </div>
      <!-- Files Grid -->
      <div *ngIf="!loading && !error && (currentFolders.length > 0 || currentDocuments.length > 0)"
           class="files-grid">
        <!-- Folders -->
        <div
          *ngFor="let folder of currentFolders; trackBy: trackByItemId"
          class="item-card folder-card"
          (click)="navigateToFolder(folder,folder.id)"
          [@slideIn]
        >
          <div class="item-header">
            <div class="item-icon-container">
              <i class="fas fa-folder item-icon"></i>
            </div>
            <div class="item-actions">
              <button
                (click)="editFolder(folder, $event)"
                class="item-action-button edit"
                title="تعديل"
              >
                <i class="fas fa-edit text-sm"></i>
              </button>
              <button
                (click)="deleteFolder(folder, $event)"
                class="item-action-button delete"
                title="حذف"
              >
                <i class="fas fa-trash text-sm"></i>
              </button>
            </div>
          </div>
          <h3 class="item-title">{{ folder.name }}</h3>
          <p class="item-description">
            {{ folder.description }}
          </p>
          <p class="item-meta">
            <i class="fas fa-calendar-alt ml-1"></i>
            {{ folder.createdAt | date:'shortDate' }}
          </p>
        </div>
        <!-- Documents -->
        <div
          *ngFor="let document of currentDocuments; trackBy: trackByItemId"
          class="item-card document-card"
          [@slideIn]
        >
          <div class="item-header">
            <div class="item-icon-container">
              <i class="fas item-icon"
                 [class.fa-file-pdf]="document.fileType === 'application/pdf'"
                 [class.fa-file-word]="document.fileType === 'application/msword'"
                 [class.fa-file-alt]="document.fileType === 'text/plain'"
                 [class.fa-music]="document.fileType === 'audio/ogg'"
                 [class.fa-file-image]="document.fileType === 'image/png'||document.fileType === 'image/jpeg'||document.fileType === 'image/gif'"
                 [class.fa-file]="document.fileType === 'other'"></i>
            </div>
            <div class="item-actions">
              <button
                (click)="viewDocument(document)"
                class="item-action-button view"
                title="عرض"
              >
                <i class="fas fa-eye text-sm"></i>
              </button>
              <button
                (click)="downloadDocument(document)"
                class="item-action-button download"
                title="تحميل"
              >
                <i class="fa-solid fa-download"></i>
              </button>
              <button
                (click)="editDocument(document)"
                class="item-action-button edit"
                title="تعديل"
              >
                <i class="fas fa-edit text-sm"></i>
              </button>
              <button
                (click)="deleteDocument(document)"
                class="item-action-button delete"
                title="حذف"
              >
                <i class="fas fa-trash text-sm"></i>
              </button>
            </div>
          </div>
          <h3 class="item-title">{{ document.fileName }}</h3>
          <div class="item-meta">
            <span>
              <i class="fas fa-calendar-alt ml-1"></i>
              {{ document.createdAt | date:'shortDate' }}
            </span>
            <span *ngIf="document.size">
              {{ formatFileSize(document.size) }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

@if (showDeleteDialog) {
  <div
    class="fixed inset-0 z-50 flex items-center justify-center p-4 delete-dialog-backdrop"
    [@fadeInOut]
  >
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" (click)="showDeleteDialog = false"></div>
    <div class="relative delete-dialog-container">
      <h3 class="delete-dialog-title">
        @if (createType==='folder') {
          {{'Delete Folder'|translate}}
        }@else {
          {{'Delete Document'|translate}}
        }
      </h3>
      <p class="delete-dialog-message">
        @if (createType==='folder') {
          {{'Are you sure you want to delete'|translate}} "{{ currentFolder?.name }}"? {{'This action cannot be undone.'|translate}}
        } @else {
          {{'Are you sure you want to delete'|translate}} "{{ currentDocument?.fileName }}"? {{'This action cannot be undone.'|translate}}
        }
      </p>
      <div class="delete-dialog-actions">
        <button
          (click)="showDeleteDialog = false"
          class="delete-dialog-button cancel"
          [disabled]="isDeleting"
        >
          {{'Cancel'|translate}}
        </button>
        <button
          (click)="confirmDelete()"
          class="delete-dialog-button confirm"
          [disabled]="isDeleting"
        >
          @if (isDeleting) {
            <i class="fas fa-spinner fa-spin"></i>
          }
          {{'Delete'|translate}}
        </button>
      </div>
    </div>
  </div>
}
<!-- Create Modal -->
<app-create-doc-item
  [isUpdated]="isUpdate"
  [workspaceId]="workspaceId"
  [isOpen]="showCreateModal"
  [itemType]="createType"
  (closeEvent)="closeCreateModal()"
></app-create-doc-item>
